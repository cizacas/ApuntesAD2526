   UNIDAD 3-parte 1



ACCESO A BASES DE DATOS
 ORIENTADAS A OBJETOS
1.- CARACTERÍSTICAS de las BDOO
Características propias de OO: Abstracción, encapsulación, herencia y
polimorfismo.
Características propias de un SGBD:
• Identidad
• Persistencia
• Concurrencia
• Recuperación ante fallos
• Gestión del almacenamiento secundario
• Facilidad de consultas.
2.- SGBD Orientados a Objetos


Oferta en el mercado

•   Sistemas cliente-servidor bajo licencias de software propietario: ObjectStore,
    Objectivity/DB o Versant.

•   Sistemas cliente-servidor bajo licencias de software libre, como Matisse, MyOODB
    y ObjectDB

•   Sistemas embebidos que se integran dentro de cada aplicación como ObjectDB,
    DataNucleus, NeoDatis, DB4O.

•   La mayoría implementan el estándar ODMG y dan soporte para ser manejados con
    Java

•   ObjectDB implementa los estándares JPA y JDO
2.- SGBD Orientados a Objetos. ObjectDB


Standard ODMG(Object Data Management Group))

• Es un conjunto de especificaciones sobre como debe ser una API que
  acceda a bases de datos orientadas a objetos.
• Cuando se dice que un SGDBOO implementa ODMG significa que su API
  respeta las especificaciones ODMG.
• Propone un modelo de datos que tiene tres lenguajes:
    – ODL: lenguaje de definición de datos
    – OML: lenguaje de manipulación de datos (prácticamente igual a SQL,
      aunque utilizando clases y propiedades en vez de tablas y columnas)
    – OQL: lenguaje de consultas de datos (prácticamente igual a SQL,
      aunque utilizando clases y propiedades en vez de tablas y columnas).
2.- SGBD Orientados a Objetos. ObjectDB


Standard JPA(Java Persistence API))

• Es un standard para acceder a bases de datos relacionales desde
  aplicaciones Java usando ORM.
• JPA a diferencia de JDBC permite representar datos de clases y objetos en
  lugar de tablas y registros.
• Object Relational Mapping (ORM) es el puente entre la representación de
  los datos en una base de datos relacional y la de clases y objetos de
  aplicaciones Java.
• ObjectDB tiene soporte integrado de JPA lo que permite que la capa
  intermedia de mapeo ORM sea eliminada.
• ObjectDB permite así usar una API idéntica a la que se usaría para acceder
  a bases de datos relacionales.
2.- SGBD Orientados a Objetos. ObjectDB


Standard JDO(Java Data Object))

•   Es otro standard para acceder a datos persistentes en bases de datos
    orientadas a objetos, utilizando clases simples asociadas a ficheros de
    metadatos que caracterizan los atributos de esas clases.

•   JDO fue diseñado para usar tanto en bases de datos relacionales como en
    bases de datos orientadas a objetos.

•   Las bases de datos ObjectDB pueden ser manipuladas por APIs por la API
    JPA o por la API JDO.

•   JPA es más utilizado.
2.- SGBD Orientados a Objetos. ObjectDB


Características de ObjectDB

 ObjectDB tiene dos distribuciones: la cliente-servidor y la que funciona en
  modo embebido.

     En modo embebido no necesita instalarse, las aplicaciones incluirán el driver
      que gestione la base de datos correspondiente. La base de datos será un
      archivo.
     En modo cliente-servidor, se instala el servidor en un equipo y las aplicaciones
      establecen conexiones con ese servidor.
3.- Proyecto Java con acceso a base de datos ObjectDB

 Para desarrollar una aplicación Java con acceso a ObjectDB, debemos
  añadir un repositorio y una dependencia Maven al archivo pom.xml.

     Repositorio
    <repository>
      <id>objectdb</id>
        <name>ObjectDB Repository</name>
        <url>https://m2.objectdb.com</url>
    </repository>


     Dependencia
    <dependency>
        <groupId>com.objectdb</groupId>
        <artifactId>objectdb</artifactId>
        <version>2.8.1</version>
    </dependency>
3.- Proyecto Java con acceso a base de datos ObjectDB

Definir las Entity Class
Para poder almacenar objetos de una clase en la base de datos usando JPA,
necesitamos definir una Entity Class. Una Entity Class JPA es una clase
POJO, es decir, una clase Java ordinaria que está marcada (anotada) para que
tenga la capacidad de representar objetos en la base de datos.

Para que una clase sea Entity Class, en su declaración tenemos que usar la
anotación JPA Entity.

Por ejemplo, esta sería una Entity Class para usar objetos persistentes de la
clase Persona:




Habrá que añadir, al menos, constructores, getter y setter.
3.- Proyecto Java con acceso a base de datos ObjectDB

Definir las Entity Class
En el ejemplo anterior de declaración de la Entity Class Empleado, quedará
marcado error en la declaración de la clase, motivado por que se requiere una
Primary Key.

Es obligatorio marcar un atributo de la clase como Id o PK. Un atributo Id sólo
puede ser de los tipos Long, Integer, String y UUID.

Por ejemplo, para declarar un atributo Id de tipo Long generado
automáticamente usaremos las anotaciones @Id y @GeneratedValue en la
declaración del atributo Id:
3.- Proyecto Java con acceso a base de datos ObjectDB

Conexiones JPA
En una aplicación que va a usar la API JPA, se va a hacer uso de los
interfaces:




EntityManagerFactory: Es una interface que, entre otras cosas, permite crear
instancias de objetos EntityManager.

EntityManager: Permite crear un contexto de persistencia, una conexión a una
base de datos en la que se pueden persistir los datos.

EntityTRansaction: Permite controlar transacciones dentro de un contexto de
persistencia.
Query: Permite realizar y controlar consultas sobre clases persistentes.
3.- Proyecto Java con acceso a base de datos ObjectDB

Conexiones JPA

Para crear una instancia de EntityManagerFactory que permite crear objetos
de conexión a una base de datos almacenada en un archivo empleados.odb
en la carpeta del proyecto.
EntityManagerFactory emf =

                Persistence.createEntityManagerFactory( "empleados.odb");

Al archivo empleados.odb se le denomina unidad de persistencia.

Cuando se crea el objeto emf, queda abierta la base de datos almacenada en
empleados.odb.

Siempre, al terminar de usar la base de datos, se debe cerrar el objeto
EntityManagerFactory.
emf.close();
3.- Proyecto Java con acceso a base de datos ObjectDB

Conexiones JPA

Una vez que tenemos un objeto EntityManagerFactory, podremos instanciar
objetos EntityManager que representarán una conexión a una base de datos.

Para crear una instancia de EntityManager, usaremos:


//emf es un objeto EntityManagerFactory
EntityManager em= emf.createEntityManager();

// Todas las operaciones sobre la base de datos
em.close();
3.- Proyecto Java con acceso a base de datos ObjectDB

Transacciones
Las operaciones que afectan el contenido de la base de datos (almacenar,
actualizar, eliminar) deben realizarse dentro de una transacción activa.

La interfaz EntityTransaction representa y administra las transacciones de la
base de datos.

Cada EntityManager puede usar una sola instancia de EntityTransaction que
se obtiene mediante el método getTransaction(). Toda transacción tiene que
iniciarse y confirmarse o anularse al finalizar. Su uso normal es:
try {
        em.getTransaction().begin();
        // operaciones que actualizan datos.
        em.getTransaction().commit();
  }
  finally {
      if (em.getTransaction().isActive())
          em.getTransaction().rollback();
  }
3.- Proyecto Java con acceso a base de datos ObjectDB

Guardar objetos Entity JPA
Para persistir o guardar un objeto Entity en la base de datos, se usa el método
persist(entity). Suponiendo que em es un objeto EntityManager y que se ha
iniciado una transacción, este es el código ejemplo para persistir un objeto
Entity empleado:




Aunque este objeto, realmente quedará guardado cuando se confirme la
transacción de la que forme parte esta operación.
Mientras tanto, el objeto estará en un estado managed.

El método persist genera una excepción IllegalArgumentException si el
argumento pasado para guardarlo no es una instancia de una clase Entity.

Si la BD ya contiene otro objeto del mismo tipo y con el mismo Id, persist
3.- Proyecto Java con acceso a base de datos ObjectDB

Obtener lista de objetos Entity JPA
Para obtener los objetos de una Entity Class almacenados en la base de
datos, podemos usar Query con lenguaje JPQL y ejecutar la query. Por
ejemplo:




La sintaxis JPQL se basa en el lenguaje SQL.
En las consultas, en los nombres de las clases y de los atributos de las clases
se diferencian mayúsculas y minúsculas.

La API JPA proporciona varias formas de obtener objetos de la BD.
3.- Proyecto Java con acceso a base de datos ObjectDB

Obtener objeto Entity JPA por Id
Podemos obtener un objeto de una Entity Class almacenado en la base de
datos por el valor de su Id, usando el método find de EntityManager.
Suponiendo que em es un objeto EntityManager, en el siguiente código se
obtiene el empleado con Id=1:
3.- Proyecto Java con acceso a base de datos ObjectDB

Modificar un objeto Entity JPA
Una vez que hemos obtenido un objeto de la BD, de la forma que sea, lo
tenemos en estado disponible para modificar. Para modificar datos de un
objeto, simplemente usamos los métodos setter dentro de una transacción
activa.

Por ejemplo para modificar el salario del empleado con Id=1, siendo em un
objeto EntityManager:
3.- Proyecto Java con acceso a base de datos ObjectDB

Eliminar un objeto Entity JPA
Una vez que hemos obtenido un objeto de la BD, de la forma que sea, lo
podemos eliminar usando el método remove.

Por ejemplo, para eliminar el empleado con Id=1 , siendo em un objeto
EntityManager:
